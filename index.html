<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Fichas de RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        .tab-button.active {
            background-color: #f59e0b; /* amber-500 */
            color: #1e293b; /* slate-800 */
            border-color: #f59e0b;
        }
        textarea {
            min-height: 80px;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        
        <!-- Seleção de Personagens -->
        <div id="character-tabs" class="mb-6 flex justify-center gap-2 border-b border-slate-700 pb-2">
            <!-- As abas dos personagens serão inseridas aqui pelo JS -->
        </div>

        <!-- Conteúdo da Ficha Editável -->
        <div id="sheet-content">
            <!-- Cabeçalho -->
            <header class="mb-8 text-center space-y-2">
                <input type="text" id="character-name" placeholder="Nome do Personagem" class="text-4xl w-full text-center font-bold text-amber-400 tracking-wider bg-transparent border-b-2 border-slate-700 focus:border-amber-400 outline-none transition">
                <input type="text" id="character-subtitle" placeholder="Conceito / Subtítulo" class="text-xl w-full text-center text-slate-400 bg-transparent outline-none focus:text-white">
            </header>

            <!-- Grid Principal -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Coluna Esquerda -->
                <div class="md:col-span-1 space-y-6">
                    <!-- Status -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-slate-700 pb-2 text-amber-300">Status</h2>
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="hp-current" class="block font-semibold mb-1">HP Atual</label>
                                <input type="number" id="hp-current" class="bg-slate-700 text-center text-lg w-full rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
                            </div>
                            <div>
                                <label for="hp-max" class="block font-semibold mb-1">HP Máx</label>
                                <input type="number" id="hp-max" class="bg-slate-700 text-center text-lg w-full rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
                            </div>
                            <div>
                                <label for="ph-current" class="block font-semibold mb-1">PH Atual</label>
                                <input type="number" id="ph-current" class="bg-slate-700 text-center text-lg w-full rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
                            </div>
                            <div>
                                <label for="ph-max" class="block font-semibold mb-1">PH Máx</label>
                                <input type="number" id="ph-max" class="bg-slate-700 text-center text-lg w-full rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
                            </div>
                            <div class="col-span-2">
                                <label for="pp-total" class="block font-semibold mb-1 text-center">Pontos de Poder (PP)</label>
                                <input type="number" id="pp-total" class="bg-slate-700 text-center text-3xl font-bold w-full rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
                            </div>
                        </div>
                    </div>

                    <!-- Atributos & Defesas -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-slate-700 pb-2 text-amber-300">Atributos & Defesas</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Atributos -->
                            <div class="text-center"><label class="text-sm text-slate-400">Força</label><input type="number" id="attr-for" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <div class="text-center"><label class="text-sm text-slate-400">Destreza</label><input type="number" id="attr-des" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <div class="text-center"><label class="text-sm text-slate-400">Constituição</label><input type="number" id="attr-con" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <div class="text-center"><label class="text-sm text-slate-400">Sabedoria</label><input type="number" id="attr-sab" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <div class="text-center"><label class="text-sm text-slate-400">Intelecto</label><input type="number" id="attr-int" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <div class="text-center"><label class="text-sm text-slate-400">Carisma</label><input type="number" id="attr-car" class="font-bold text-lg bg-slate-700 w-full rounded text-center"></div>
                            <!-- Defesas -->
                            <div class="col-span-2 mt-4 text-center"><label class="text-sm text-slate-400">Classe de Armadura (CA)</label><input type="number" id="ca" class="font-bold text-2xl bg-slate-700 w-full rounded text-center"></div>
                        </div>
                        <div class="mt-6 border-t border-slate-700 pt-4">
                            <h3 class="font-semibold text-lg text-center mb-2">Redução de Dano (RD)</h3>
                            <div id="rd-container" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Coluna Direita -->
                <div class="md:col-span-2 space-y-6">
                     <!-- Raça / Origem -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 border-b-2 border-slate-700 pb-2 text-amber-300">Raça / Origem</h2>
                        <input type="text" id="race-name" placeholder="Nome da Raça" class="font-bold text-lg bg-slate-700 w-full rounded p-1 mb-2">
                        <textarea id="race-description" placeholder="Descrição da Raça" class="text-sm text-slate-400 bg-slate-700 w-full rounded p-1 mb-2"></textarea>
                        <label class="font-semibold text-sm">Benefícios (um por linha)</label>
                        <textarea id="race-benefits" placeholder="Benefício 1&#10;Benefício 2" class="text-sm bg-slate-700 w-full rounded p-1"></textarea>
                    </div>

                    <!-- Estigmas -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-slate-700 pb-2">
                            <h2 class="text-2xl font-bold text-amber-300">Estigmas</h2>
                            <button onclick="addItem('stigmas')" class="bg-green-600 hover:bg-green-500 text-white font-bold text-sm px-3 py-1 rounded-full transition-colors">+ Adicionar</button>
                        </div>
                        <div id="stigmas-container" class="space-y-4"></div>
                    </div>

                    <!-- Perícias -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-slate-700 pb-2">
                            <h2 class="text-2xl font-bold text-amber-300">Perícias</h2>
                            <button onclick="addItem('skills')" class="bg-green-600 hover:bg-green-500 text-white font-bold text-sm px-3 py-1 rounded-full transition-colors">+ Adicionar</button>
                        </div>
                        <div id="skills-container" class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2"></div>
                    </div>

                    <!-- Poderes -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-slate-700 pb-2">
                            <h2 class="text-2xl font-bold text-amber-300">Poderes</h2>
                            <button onclick="addItem('powers')" class="bg-green-600 hover:bg-green-500 text-white font-bold text-sm px-3 py-1 rounded-full transition-colors">+ Adicionar</button>
                        </div>
                        <div id="powers-container" class="space-y-6"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // --- LÓGICA DA APLICAÇÃO ---

    const MAX_CHARACTERS = 3;
    let state = {
        characters: [],
        activeIndex: 0,
    };

    // --- MODELO DE DADOS PARA UMA FICHA EM BRANCO ---
    const createBlankCharacter = () => ({
        name: "", subtitle: "",
        hp: { current: 10, max: 10 }, ph: { current: 10, max: 10 }, pp: 0, ca: 10,
        attributes: { for: 0, des: 0, con: 0, sab: 0, int: 0, car: 0 },
        rd: { balistico: { value: 0, active: false }, concussao: { value: 0, active: false }, cortante: { value: 0, active: false }, perfurante: { value: 0, active: false }, eletrico: { value: 0, active: false }, fogo: { value: 0, active: false }, frio: { value: 0, active: false }, sonico: { value: 0, active: false }, acido: { value: 0, active: false } },
        race: { name: "", description: "", benefits: "" },
        stigmas: [], skills: [], powers: [],
    });

    // --- GERENCIAMENTO DE ESTADO (localStorage) ---
    const saveState = () => {
        localStorage.setItem('rpgSheetsState', JSON.stringify(state));
    };

    const loadState = () => {
        const savedState = localStorage.getItem('rpgSheetsState');
        if (savedState) {
            state = JSON.parse(savedState);
        } else {
            // Inicializa com fichas em branco se não houver nada salvo
            for (let i = 0; i < MAX_CHARACTERS; i++) {
                state.characters.push(createBlankCharacter());
            }
        }
    };

    // --- RENDERIZAÇÃO (Atualiza a UI com os dados do estado) ---
    const renderSheet = () => {
        const char = state.characters[state.activeIndex];
        if (!char) return;

        // Cabeçalho
        document.getElementById('character-name').value = char.name;
        document.getElementById('character-subtitle').value = char.subtitle;
        
        // Status
        document.getElementById('hp-current').value = char.hp.current;
        document.getElementById('hp-max').value = char.hp.max;
        document.getElementById('ph-current').value = char.ph.current;
        document.getElementById('ph-max').value = char.ph.max;
        document.getElementById('pp-total').value = char.pp;
        
        // Atributos e Defesas
        Object.keys(char.attributes).forEach(key => {
            document.getElementById(`attr-${key}`).value = char.attributes[key];
        });
        document.getElementById('ca').value = char.ca;
        
        // RD
        const rdContainer = document.getElementById('rd-container');
        rdContainer.innerHTML = Object.keys(char.rd).map(type => `
            <div class="flex items-center justify-between text-sm gap-3">
                <input type="checkbox" data-rd-type="${type}" ${char.rd[type].active ? 'checked' : ''} class="rd-active w-4 h-4 rounded bg-slate-700 border-slate-600 text-amber-500 focus:ring-amber-500 cursor-pointer">
                <label class="capitalize flex-1">${type}</label>
                <input type="number" data-rd-type="${type}" value="${char.rd[type].value}" class="rd-value bg-slate-700 text-center w-16 rounded-md border-slate-600 focus:ring-amber-400 focus:border-amber-400">
            </div>`).join('');

        // Raça
        document.getElementById('race-name').value = char.race.name;
        document.getElementById('race-description').value = char.race.description;
        document.getElementById('race-benefits').value = char.race.benefits;

        // Estigmas
        renderDynamicList('stigmas', char.stigmas, (item, index) => `
            <div class="border-t border-slate-700 pt-3">
                <div class="flex justify-between items-start gap-2">
                    <div class="flex-grow space-y-2">
                        <input type="text" value="${item.name || ''}" data-index="${index}" data-field="name" placeholder="Nome do Estigma" class="stigmas-input font-semibold bg-slate-700 w-full rounded p-1">
                        <textarea data-index="${index}" data-field="description" placeholder="Descrição do Estigma" class="stigmas-input text-sm text-slate-400 bg-slate-700 w-full rounded p-1">${item.description || ''}</textarea>
                    </div>
                    <button onclick="deleteItem('stigmas', ${index})" class="bg-red-600 hover:bg-red-500 text-white font-bold text-xs w-6 h-6 rounded-full transition-colors mt-1">X</button>
                </div>
            </div>`);

        // Perícias
        renderDynamicList('skills', char.skills, (item, index) => `
            <div class="flex items-center gap-2">
                <input type="text" value="${item.name || ''}" data-index="${index}" data-field="name" placeholder="Nome da Perícia" class="skills-input bg-slate-700 w-full rounded p-1 text-sm">
                <input type="number" value="${item.value || 0}" data-index="${index}" data-field="value" class="skills-input bg-slate-700 w-16 text-center rounded p-1 text-sm font-bold">
                <button onclick="deleteItem('skills', ${index})" class="bg-red-600 hover:bg-red-500 text-white font-bold text-xs w-5 h-5 rounded-full transition-colors">X</button>
            </div>`);
        
        // Poderes
        const actionTypes = ["Ação", "Ação Bônus", "Ação Livre", "Reação", "Ação Completa", "Movimento", "Passivo"];
        renderDynamicList('powers', char.powers, (item, index) => `
            <div class="border-t border-slate-700 pt-4">
                <div class="flex justify-between items-center mb-2">
                    <input type="text" value="${item.name || ''}" data-index="${index}" data-field="name" placeholder="Nome do Poder" class="powers-input text-xl font-bold text-amber-300 bg-transparent flex-grow outline-none focus:text-amber-200">
                    <button onclick="deleteItem('powers', ${index})" class="bg-red-600 hover:bg-red-500 text-white font-bold text-xs w-6 h-6 rounded-full transition-colors">X</button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                    <div>
                        <label class="text-xs font-semibold">Tipo de Ação</label>
                        <select data-index="${index}" data-field="action" class="powers-input bg-slate-700 w-full rounded p-1 text-sm">
                            ${actionTypes.map(type => `<option value="${type}" ${item.action === type ? 'selected' : ''}>${type}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-semibold">Custo em PH</label>
                        <input type="number" value="${item.cost || 0}" data-index="${index}" data-field="cost" class="powers-input bg-slate-700 w-full rounded p-1 text-sm">
                    </div>
                </div>
                <div class="space-y-2">
                    <div><label class="text-xs font-semibold">Descrição</label><textarea data-index="${index}" data-field="description" placeholder="Descrição do poder..." class="powers-input text-sm bg-slate-700 w-full rounded p-1">${item.description || ''}</textarea></div>
                    <div><label class="text-xs font-semibold">Falhas (Opcional)</label><textarea data-index="${index}" data-field="flaws" placeholder="Desvantagens do poder..." class="powers-input text-sm bg-slate-700 w-full rounded p-1">${item.flaws || ''}</textarea></div>
                    <div><label class="text-xs font-semibold">Extras (Opcional)</label><textarea data-index="${index}" data-field="extras" placeholder="Vantagens do poder..." class="powers-input text-sm bg-slate-700 w-full rounded p-1">${item.extras || ''}</textarea></div>
                </div>
            </div>`);

        renderCharacterTabs();
    };
    
    const renderDynamicList = (key, list, template) => {
        const container = document.getElementById(`${key}-container`);
        container.innerHTML = list.map(template).join('');
    };

    const renderCharacterTabs = () => {
        const tabsContainer = document.getElementById('character-tabs');
        tabsContainer.innerHTML = '';
        for (let i = 0; i < MAX_CHARACTERS; i++) {
            const char = state.characters[i];
            const name = char.name || `Ficha ${i + 1}`;
            const isActive = i === state.activeIndex;
            const button = document.createElement('button');
            button.innerText = name;
            button.onclick = () => switchCharacter(i);
            button.className = `tab-button py-2 px-4 font-semibold rounded-t-lg border-b-2 border-transparent transition-colors ${isActive ? 'active' : ''}`;
            tabsContainer.appendChild(button);
        }
    };
    
    // --- MANIPULAÇÃO DE DADOS (Interação do Usuário) ---
    const updateCharacterData = (event) => {
        const char = state.characters[state.activeIndex];
        const el = event.target;
        const id = el.id;

        if (id.startsWith('attr-')) {
            char.attributes[id.replace('attr-', '')] = el.value;
        } else if (id.includes('-')) {
            const [key, prop] = id.split('-');
            char[key][prop] = el.value;
        } else if (el.classList.contains('rd-value') || el.classList.contains('rd-active')) {
            const type = el.dataset.rdType;
            if (el.type === 'checkbox') {
                char.rd[type].active = el.checked;
            } else {
                char.rd[type].value = el.value;
            }
        } else if (el.classList.contains('stigmas-input') || el.classList.contains('skills-input') || el.classList.contains('powers-input')) {
            const key = el.className.split(' ')[0].replace('-input', '');
            const index = el.dataset.index;
            const field = el.dataset.field;
            char[key][index][field] = el.value;
        } else {
            char[id.replace('character-', '')] = el.value;
        }

        if (id === 'character-name') {
            renderCharacterTabs();
        }
        
        saveState();
    };

    const switchCharacter = (index) => {
        state.activeIndex = index;
        saveState();
        renderSheet();
    };

    const addItem = (key) => {
        const char = state.characters[state.activeIndex];
        let newItem = {};
        if (key === 'skills') newItem = { name: '', value: 0 };
        if (key === 'stigmas') newItem = { name: '', description: '' };
        if (key === 'powers') newItem = { name: '', action: 'Ação', cost: 0, description: '', flaws: '', extras: '' };
        
        char[key].push(newItem);
        saveState();
        renderSheet();
    };
    
    const deleteItem = (key, index) => {
        if (confirm(`Tem certeza que deseja apagar este item?`)) {
            const char = state.characters[state.activeIndex];
            char[key].splice(index, 1);
            saveState();
            renderSheet();
        }
    };

    // --- INICIALIZAÇÃO E EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        loadState();
        renderSheet();
        document.getElementById('sheet-content').addEventListener('input', updateCharacterData);
    });

    </script>
</body>
</html>
